name: E2E Tests (Deployed)
on:
  push:
    branches:
      - "dschrashun/7973-e2e-ci-staging-refactor"
  workflow_dispatch:
    inputs:
      version:
        description: "git reference to deploy (e.g., a branch, tag, or commit SHA)"
        required: true
        type: string
      target:
        description: "application environment to run tests against (dev / prod TK)"
        required: true
        default: "staging"
        type: choice
        options:
          - staging

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  e2e-tests-deployed:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: true
      matrix:
        shard: [1, 2, 3, 4]
        total_shards: [4]

    steps:
      - uses: ./.github/workflows/e2e
        with:
          version: ${{ inputs.version || github.ref }}
          target: ${{ inputs.target }}
          total_shards: ${{ matrix.total_shards }}
          current_shard: ${{ matrix.shard }}
      - uses: ./.github/workflows/e2e/e2e-create-report.yml
        if: ${{ !cancelled() }}
