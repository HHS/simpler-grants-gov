"""Remove is_deleted and revision_number from opportunity summary

Revision ID: 8f5a763ccc79
Revises: bbf5ec36a497
Create Date: 2025-03-03 19:42:35.669122

"""

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "8f5a763ccc79"
down_revision = "20590d71bc20"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(
        "opportunity_summary_is_forecast_uniq", "opportunity_summary", schema="api", type_="unique"
    )
    op.create_unique_constraint(
        op.f("opportunity_summary_is_forecast_uniq"),
        "opportunity_summary",
        ["is_forecast", "opportunity_id"],
        schema="api",
    )
    op.drop_column("opportunity_summary", "is_deleted", schema="api")
    op.drop_column("opportunity_summary", "revision_number", schema="api")
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "opportunity_summary",
        sa.Column("revision_number", sa.INTEGER(), autoincrement=False, nullable=True),
        schema="api",
    )
    op.add_column(
        "opportunity_summary",
        sa.Column("is_deleted", sa.BOOLEAN(), autoincrement=False, nullable=True),
        schema="api",
    )
    op.drop_constraint(
        op.f("opportunity_summary_is_forecast_uniq"),
        "opportunity_summary",
        schema="api",
        type_="unique",
    )
    op.create_unique_constraint(
        "opportunity_summary_is_forecast_uniq",
        "opportunity_summary",
        ["is_forecast", "revision_number", "opportunity_id"],
        schema="api",
        postgresql_nulls_not_distinct=True,
    )
    # ### end Alembic commands ###
